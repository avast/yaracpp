# YARA C++ Wrapper

[![Travis CI build status](https://travis-ci.org/avast/yaracpp.svg?branch=master)](https://travis-ci.org/avast/yaracpp)
[![AppVeyor build status](https://ci.appveyor.com/api/projects/status/github/avast/yaracpp?branch=master&svg=true)](https://ci.appveyor.com/project/avast/yaracpp?branch=master)

C++ wrapper for [YARA](https://github.com/VirusTotal/yara).

## Usage Example

```cpp
#include <iostream>
#include "yaracpp/yaracpp.h"

int main() {
    yaracpp::YaraDetector yara;
    yara.addRules(R"(
        rule example {
            strings:
                $s = "Hello"
            condition:
                $s
        })");
    yara.addRuleFile("/path/to/yara_file.yar");

    if (yara.analyze("/path/to/scanned/file")) {
        for (const auto& rule : yara.getDetectedRules()) {
            std::cout << rule << '\n';
        }
    }
}
```

## Fetching meta data:

```cpp
#include <iostream>
#include <vector>
#include <yaracpp/yaracpp.h>

int main()
{
	yaracpp::YaraDetector yara;

	// ADD A SAMPLE RULE FILES
	yara.addRuleFile("signatures/bot.yar");
	yara.addRuleFile("signatures/main.yar");

	if (yara.analyze("test.bin"))
	{
		std::vector<yaracpp::YaraRule> matched_rules = yara.getDetectedRules();
		std::cout << "Total Rules Matched: " << matched_rules.size() << "\n";

		std::vector<yaracpp::YaraRule> unmatched_rules = yara.getUndetectedRules();
		std::cout << "Total Rules Un-matched: " << unmatched_rules.size() << "\n\n";

		for (yaracpp::YaraRule rule : matched_rules)
		{
			std::cout << "Matched Rule Name: " << rule.getName() << "\n";
			std::cout << "Meta Information Count: " << rule.getNumberOfMetas() << "\n";

			// PRINT THE META INFORMATIONS
			std::cout << "META INFOMATIONS:\n";
			std::vector<yaracpp::YaraMeta> meta_informations = rule.getMetas();
			for (yaracpp::YaraMeta meta : meta_informations)
			{
				std::cout << meta.getId() << " : " << meta.getStringValue() << "\n";
			}
			std::cout << "\n";
		}
	}
}
```

### Output:
```
Total Rules Matched: 2
Total Rules Un-matched: 0

Matched Rule Name: bot
Meta Information Count: 2
META INFOMATIONS:
author : Visweswaran
description : BOT

Matched Rule Name: example
Meta Information Count: 1
META INFOMATIONS:
description : EXAMPLE - 1
```

## Requirements

* A compiler supporting C++14
  * GCC 4.9+
  * Visual Studio 2015+
* CMake (version >= 3.6)
* On Linux, macOS, and MinGW:
  * Install these packages using your package manager: `autoconf automake libtool`
* On macOS also install [command-line tools](https://github.com/frida/frida/issues/338#issuecomment-426777849) (see [avast/retdec#425](https://github.com/avast/retdec/issues/425) and [avast/retdec#433](https://github.com/avast/retdec/issues/433))

## Build and Installation

* Clone the repository:
  * `git clone https://github.com/avast/yaracpp.git`
* Linux, macOS, and MinGW:
  * `cd yaracpp`
  * `mkdir build && cd build`
  * `cmake -DCMAKE_BUILD_TYPE=<Debug|Release> ..`
  * `make -jN` (`N` is the number of CPU cores to use for parallel build)
* Windows:
  * Open a command prompt (e.g. `C:\msys64\msys2_shell.cmd` from [MSYS2](https://github.com/avast/retdec/wiki/Windows-Environment))
  * `cd yaracpp`
  * `mkdir build && cd build`
  * `cmake -G<generator> ..`
    * `-G<generator>` is `-G"Visual Studio 14 2015"` for 32-bit build using Visual Studio 2015, or `-G"Visual Studio 14 2015 Win64"` for 64-bit build using Visual Studio 2015. Of course, any later version of Visual Studio may be used.
  * `cmake --build . --config Release -- -m`
  * Alternatively, you can open `yaracpp.sln` generated by `cmake` in Visual Studio IDE.

## License

Copyright (c) 2017 Avast Software, licensed under the MIT license. See the `LICENSE` file for more details.

`yaracpp` uses third-party libraries or other resources listed, along with their licenses, in the `LICENSE-THIRD-PARTY` file.

## Contributing

See [RetDec contribution guidelines](https://github.com/avast/retdec/wiki/Contribution-Guidelines).
